<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.royalty.backend.trademark.mapper.TrademarkMapper">

    <select id="selectTrademarkList" resultType="com.royalty.backend.trademark.dto.TrademarkDto">
        SELECT 
            patent_id          AS patentId,
            application_number AS applicationNumber,
            trademark_name     AS trademarkName,
            image_url          AS imageUrl,
            applicant          AS applicant,
            category           AS category,
            application_date   AS applicationDate,
            
            registered_date  AS registeredDate
            
        FROM patent
        WHERE 1=1
        <if test="category != null and category != ''">
            AND category = #{category}
        </if>
        <if test="keyword != null and keyword != ''">
            AND trademark_name LIKE CONCAT('%', #{keyword}, '%')
        </if>
        ORDER BY application_date DESC
        LIMIT #{size} OFFSET #{offset}
    </select>
    
    <select id="countTrademarkList" resultType="int">
        SELECT count(*) FROM patent WHERE 1=1
        <if test="category != null and category != ''">
            AND category = #{category}
        </if>
        <if test="keyword != null and keyword != ''">
            AND trademark_name LIKE CONCAT('%', #{keyword}, '%')
        </if>
    </select>

    <select id="selectTrademarkById" resultType="com.royalty.backend.trademark.dto.TrademarkDto">
        SELECT 
            patent_id          AS patentId,
            application_number AS applicationNumber,
            trademark_name     AS trademarkName,
            image_url          AS imageUrl,
            applicant          AS applicant,
            category           AS category,
            application_date   AS applicationDate,
            
            registered_date    AS registeredDate
            
        FROM patent
        WHERE patent_id = #{id}
    </select>

    <select id="existsBookmark" resultType="int">
        SELECT count(*) 
        FROM bookmark 
        WHERE user_id = #{userId} AND patent_id = #{patentId}
    </select>
    
    <insert id="insertBookmark">
        INSERT INTO bookmark (user_id, patent_id, created_at)
        VALUES (#{userId}, #{patentId}, NOW())
        ON CONFLICT (user_id, patent_id) DO NOTHING
    </insert>
    
    <delete id="deleteBookmark">
        DELETE FROM bookmark 
        WHERE user_id = #{userId} AND patent_id = #{patentId}
    </delete>

</mapper>